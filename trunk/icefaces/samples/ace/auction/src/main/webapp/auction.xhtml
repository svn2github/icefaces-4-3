<!--
  ~ Copyright 2004-2014 ICEsoft Technologies Canada Corp.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the
  ~ License. You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an "AS
  ~ IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
  ~ express or implied. See the License for the specific language
  ~ governing permissions and limitations under the License.
  -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:auction="http://java.sun.com/jsf/composite/components"
                xmlns:icecore="http://www.icefaces.org/icefaces/core">
<h:head>
    <title>#{msgs['auction.template.title']}</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <h:outputStylesheet library="css" name="demo_template.css"/>
    <h:outputStylesheet library="css" name="auction_styles.css"/>
    <link href="./resources/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
    <link href="./resources/images/favicon.ico" rel="icon" type="image/x-icon"/>
    
    <script type="text/javascript">
	    function focusBid() {
	    	var bidIn = document.getElementById('a:bidIn_input');
	    	if (bidIn) {
		    	bidIn.focus();
		    	bidIn.select();
	    	}
	    }
    </script>
</h:head>

<h:body>
    <h:outputText value="#{pushBean}" style="display: none; height: 0;"/>
    <h:outputText value="#{bidRobot}" style="display: none; height: 0;"/>
    
    <h:form id="n" prependId="false">
		<ace:notificationPanel id="messagePanel"
			                   visible="#{globalMessage.hasNew}" position="top"
			                   effect="slide" effectSpeed="slow"
			                   style="background: #{settingsBean.notificationBackground}; color: #{settingsBean.notificationForeground};">
			<h:panelGroup layout="block" styleClass="notificationBarWrap">
                <ui:repeat value="#{globalMessage.messages}" var="gmessage">
                    #{gmessage}<br/>
                </ui:repeat>
			</h:panelGroup>
		</ace:notificationPanel>
	</h:form>

    <h:graphicImage library="images" name="banner_hdr_auction.jpg"/>
    
    <!-- TODO Add a View History / Bid History button, maybe to the details panel, that brings up a graph of past bids (in a popup or below details panel?) -->
    <!-- TODO Add an Add Item button (floating top right of the table?) that does a popup with item details to add -->
    <!-- TODO Split this page into includes on a per-tab basis, to make it more readable? -->
    
    <div class="auctionMonitorContainer">
        <ace:tabSet id="at" orientation="#{settingsBean.tabOrientation}">
            <ace:tabPane label="Auction List">
		        <h:form id="f" prependId="false">
		            <ace:tabSetProxy for="at"/>
		            
		            <h:messages globalOnly="true" layout="table"/>
		            
		            <ace:dataTable id="a"
		                           value="#{auctionService.auctions}" var="item"
		                           styleClass="auctionMontiorTable"
		                           clickableHeaderSorting="true"
		                           emptyMessage="No auctions were found, please try again later."
		                           paginator="true" paginatorAlwaysVisible="false" paginatorPosition="bottom"
		                           rows="20"
		                           reorderableColumns="true" resizableColumns="true"
		                           alwaysExecuteContents="true"
		                           stateMap="#{bidBean.stateMap}"
		                           selectionMode="single"
		                           rowSelectListener="#{bidController.selectItem}"
		                           rowUnselectListener="#{bidController.unselectItem}">
		                <f:facet name="header">
		                    Auction List
		                </f:facet>
		                <ace:column headerText="Name" styleClass="#{not empty globalMessage.lastUpdated and item eq globalMessage.lastUpdated ? 'updateC' : ''}">
		                    #{item.name}
		                </ace:column>
		                <ace:column headerText="Price" styleClass="#{not empty globalMessage.lastUpdated and item eq globalMessage.lastUpdated ? 'updateC' : ''}"
		                            style="text-align: right;">
		                    <h:outputText value="#{item.price}">
		                        <f:convertNumber type="currency" currencySymbol="$"/>
		                    </h:outputText>
		                </ace:column>
		                <ace:column headerText="Bids" styleClass="#{not empty globalMessage.lastUpdated and item eq globalMessage.lastUpdated ? 'updateC' : ''}">
		                    #{item.bids}
		                </ace:column>
		                <ace:column headerText="Time Left" styleClass="#{not empty globalMessage.lastUpdated and item eq globalMessage.lastUpdated ? 'updateC' : ''}">
		                    <h:outputText id="e" value="#{item.expiryDate}">
		                        <f:converter converterId="TimeLeftConverter"/>
		                    </h:outputText>
		                </ace:column>
		                <f:facet name="footer">
		                    <h:panelGroup layout="block">
		                        <h:panelGroup id="footWrap" layout="block" rendered="#{bidBean.renderBidPanel}">
		                            <icecore:defaultAction actionListener="#{bidController.submitBid}" key="Enter"/>
		                            <icecore:defaultAction actionListener="#{bidController.cancelBid}" key="Esc"/>
		                            <h:outputLabel for="bidIn" value="Bid on '#{bidBean.bidItem.name}':"/>
		                            <ace:textEntry id="bidIn" value="#{bidBean.currentBid}"
		                                           required="true" requiredMessage="Enter a valid bid."
		                                           size="10">
		                                <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
		                            </ace:textEntry>
		                            <h:commandButton id="submitBid" value="Submit" actionListener="#{bidController.submitBid}"/>
		                            <h:commandButton value="Cancel" immediate="true" actionListener="#{bidController.cancelBid}"/>
		                            <br/>
		                            <h:message for="bidIn"/>
		                            <h:message for="footWrap"/>
		                        </h:panelGroup>
		                        <h:outputText value="Select a row to begin bidding." rendered="#{!bidBean.renderBidPanel}"/>
		                    </h:panelGroup>
		                </f:facet>
		            </ace:dataTable>
		            
		            <ace:panel closable="false" collapsed="false" toggleable="true"
		                       header="Details of Listed Item '#{bidBean.bidItem.name}'"
		                       rendered="#{bidBean.renderBidPanel}"
		                       style="margin-top: 15px;">
			            <h:panelGrid columns="2">
			                <h:outputText value="Condition:"/>
			                #{bidBean.bidItem.condition.value}
			                
			                <h:outputText value="Seller Name:"/>
			                #{bidBean.bidItem.sellerName}
			                
			                <h:outputText value="Seller Location:"/>
			                #{bidBean.bidItem.sellerLocation}
			                
			                <h:outputText value="Estimated Delivery:"/>
			                #{bidBean.bidItem.estimatedDelivery.value}
			                
			                <h:outputText value="Shipping Cost:"/>
			                <h:outputText value="#{bidBean.bidItem.shippingCost}">
			                   <f:convertNumber type="currency" currencySymbol="$"/>
			                </h:outputText>
			                
			                <h:outputText value="Description:"/>
			                #{bidBean.bidItem.description}
			            </h:panelGrid>
		            </ace:panel>
		        </h:form>
	        </ace:tabPane>
	        <ace:tabPane label="Auction Logs">
	            <h:form id="al" prependId="false">
		            <ace:tabSetProxy for="at"/>
		            <ace:dataTable id="m" value="#{globalMessage.messages}" var="gmessage"
		                           emptyMessage="No auction log messages yet."
		                           reorderableColumns="false" resizableColumns="false"
		                           paginator="false"
		                           rows="#{globalMessage.fullLogCount}">
		                <f:facet name="header">
		                    <h:outputText value="Previous #{globalMessage.visibleLogCount} Auction Messages"/>
		                </f:facet>
		                <ace:column style="text-align: left;">
		                    #{gmessage}
		                </ace:column>
                        <f:facet name="footer">
                            <h:outputText value="Previous #{globalMessage.visibleLogCount} Auction Messages"
                                          rendered="#{globalMessage.visibleLogCount > globalMessage.fullLogCount/2}"/>
                        </f:facet>
		            </ace:dataTable>
                </h:form>
	        </ace:tabPane>
	        <ace:tabPane label="Settings">
	            <h:form id="s" prependId="false">
	                <ace:tabSetProxy for="at"/>
	                
	                <icecore:defaultAction actionListener="#{settingsController.save}" key="Enter"/>
	                
                    <ace:panel closable="false" collapsed="false" toggleable="true"
                               header="Application Settings">
		                <h:panelGrid columns="4" cellpadding="5" cellspacing="5">
		                    <h:graphicImage id="nameInHelp" library="images" name="help.png"/>
		                    <h:outputLabel for="nameIn" value="Name:"/>
		                    <ace:textEntry id="nameIn" value="#{settingsBean.name}" required="true"
		                                   autocapitalize="on" autocomplete="on" maxlength="15"
		                                   placeholder="Enter your name">
		                        <f:validateLength minimum="3" maximum="15"/>
		                    </ace:textEntry>
		                    <h:message for="nameIn"/>
		                    
		                    <h:graphicImage id="dbidHelp" library="images" name="help.png"/>
		                    <h:outputLabel for="dbid" value="Default Bid Increment:"/>
		                    <ace:textEntry id="dbid" value="#{settingsBean.bidIncrement}" required="true"
		                                   maxlength="5">
		                        <f:validateDoubleRange minimum="1.0" maximum="100.0"/>
		                    </ace:textEntry>
		                    <h:message for="dbid"/>
		                    
		                    <h:graphicImage id="taboHelp" library="images" name="help.png"/>
	                        <h:outputLabel for="tabo" value="Tab Orientation:"/>
	                        <h:selectOneRadio id="tabo" value="#{settingsBean.tabOrientation}" required="true">
	                            <f:selectItems value="#{listData.tabOrientations}"/>
	                        </h:selectOneRadio>
	                        <h:message for="tabo"/>
		                    
		                    <h:graphicImage id="ncolorbHelp" library="images" name="help.png"/>
		                    <h:outputLabel for="ncolorb" value="Notification Background:" required="true"/>
		                    <auction:colorPicker id="ncolorb"
		                                         value="#{settingsBean.notificationBackground}"/>
		                    <h:message for="ncolorb"/>
		                    
		                    <h:graphicImage id="ncolorfHelp" library="images" name="help.png"/>
		                    <h:outputLabel for="ncolorf" value="Notification Foreground:" required="true"/>
		                    <auction:colorPicker id="ncolorf"
		                                         value="#{settingsBean.notificationForeground}"/>
		                    <h:message for="ncolorf"/>
		                    
		                    <h:graphicImage id="saveHelp" library="images" name="help.png"/>
                            <h:outputLabel for="save" value="Save settings in web browser cookies?"/>
                            <h:selectBooleanCheckbox id="save" value="#{settingsBean.saveCookie}" required="true"/>
                            <h:message for="save"/>
		                </h:panelGrid>
		                
		                <f:facet name="footer">
                            <h:panelGroup layout="block">
                                <h:commandButton value="Submit" actionListener="#{settingsController.save}"/>
                                
                                <h:messages globalOnly="true" layout="table"/>
                            </h:panelGroup>
	                    </f:facet>
	                </ace:panel>
	                
	                <ace:tooltip for="nameInHelp" speechBubble="true">
	                    Customize the name you want associated with all bids (must be 3 to 15 characters).
	                </ace:tooltip>
	                
	                <ace:tooltip for="dbidHelp" speechBubble="true">
	                    When you begin a bid on an item the default price amount will be automatically incremented by this number (1-100).
	                </ace:tooltip>
	                
	                <ace:tooltip for="taboHelp" speechBubble="true">
	                    Choose how you want the tab pane laid out on the page.
	                </ace:tooltip>
	                
	                <ace:tooltip for="ncolorbHelp" speechBubble="true">
	                    Customize the background color of the notification panel that displays messages at the top of the page.
	                </ace:tooltip>
	                
	                <ace:tooltip for="ncolorfHelp" speechBubble="true">
	                    Customize the foreground text color of the notification panel that displays messages at the top of the page.
	                </ace:tooltip>
	                
	                <ace:tooltip for="saveHelp" speechBubble="true">
	                    If selected then your choices on this form will be stored as web browser cookies, and reloaded from there on subsequent visits.
	                </ace:tooltip>
	            </h:form>
	        </ace:tabPane>
        </ace:tabSet>
    </div>
</h:body>
</html>
