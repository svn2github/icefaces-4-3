<!--
  ~ Copyright 2004-2014 ICEsoft Technologies Canada Corp.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the
  ~ License. You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an "AS
  ~ IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
  ~ express or implied. See the License for the specific language
  ~ governing permissions and limitations under the License.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:icecore="http://www.icefaces.org/icefaces/core">
<h:head>
    <title>#{msgs['auction.template.title']}</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <h:outputStylesheet library="css" name="demo_template.css"/>
    <h:outputStylesheet library="css" name="auction_styles.css"/>
    <link href="./resources/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
    <link href="./resources/images/favicon.ico" rel="icon" type="image/x-icon"/>
    
    <script type="text/javascript">
	    function focusBid() {
	    	var bidIn = document.getElementById('a:bidIn_input');
	    	if (bidIn) {
		    	bidIn.focus();
		    	bidIn.select();
	    	}
	    }
    </script>
</h:head>

<h:body>
    <h:outputText value="#{pushBean}" style="display: none; height: 0;"/>
    <h:outputText value="#{bidRobot}" style="display: none; height: 0;"/>

    <h:graphicImage library="images" name="banner_hdr_auction.jpg"/>
    
    <!-- TODO Add a View History / Bid History button, maybe to the details panel, that brings up a graph of past bids (in a popup or below details panel?) -->
    <!-- TODO Add an Add Item button (floating top right of the table?) that does a popup with item details to add -->
    <!-- TODO Add a Chat tab like the old demo? -->
    <!-- TODO Add a clock image or progress bar beside the time left text column to give a visual cue to remainder to expiry -->
    <!-- TODO Need to put manual Pushes throughout the app so it could technically function without the constant polling, perhaps check AuctionWatcher and do push otherwise?
              For example GlobalMessageBean update would need a push -->
    
    <div class="auctionMonitorContainer">
        <ace:tabSet id="at" orientation="#{settingsBean.tabOrientation}">
            <ace:tabPane label="Auction List">
		        <h:form id="f" prependId="false">
		            <ace:tabSetProxy for="at"/>
		            
		            <ui:include src="/WEB-INF/includes/list-tab.xhtml"/>
		        </h:form>
	        </ace:tabPane>
	        <ace:tabPane label="Auction Logs">
	            <h:form id="al" prependId="false">
		            <ace:tabSetProxy for="at"/>
		            
		            <ui:include src="/WEB-INF/includes/logs-tab.xhtml"/>
                </h:form>
	        </ace:tabPane>
	        <ace:tabPane label="Settings">
	            <h:form id="s" prependId="false">
	                <ace:tabSetProxy for="at"/>
	                
	                <ui:include src="/WEB-INF/includes/settings-tab.xhtml"/>
	            </h:form>
	        </ace:tabPane>
        </ace:tabSet>
    </div>
    
    <h:form id="n" prependId="false">
        <ace:notificationPanel id="messagePanel"
                               visible="#{globalMessage.hasNew}" position="top"
                               effect="slide" effectSpeed="slow"
                               style="background: #{settingsBean.notificationBackground}; color: #{settingsBean.notificationForeground};">
            <h:panelGroup layout="block" styleClass="notificationBarWrap">
                <ui:repeat value="#{globalMessage.messages}" var="gmessage">
                    #{gmessage}<br/>
                </ui:repeat>
            </h:panelGroup>
        </ace:notificationPanel>
    </h:form>
    
    <h:form id="hd" prependId="false">
        <ace:dialog id="historyDialog"
                    visible="#{bidBean.showHistoryDialog}"
                    rendered="#{bidBean.showHistoryDialog}"
                    closable="true" closeOnEscape="true"
                    draggable="true" modal="true" resizable="false"
                    header="Bid History for '#{bidBean.bidItem.name}'"
                    width="#{settingsBean.chartWidth+70}">
            <ace:ajax event="close" listener="#{bidController.closeHistoryDialogListener}"/>
            
            <h:panelGroup layout="block" style="margin: 20px;">
	            <ace:chart id="historyChart"
	                       animated="true"
	                       value="#{chartBean.historyData}"
	                       legend="true"
	                       legendPlacement="INSIDE_GRID"
	                       legendLocation="NW"
	                       xAxis="#{chartBean.xAxis}"
	                       yAxes="#{chartBean.yAxis}"
	                       width="#{settingsBean.chartWidth}"
	                       highlighter="true"
	                       rendered="#{chartBean.type ne null}"/>
	                       
	            <ace:dataTable id="bhT" value="#{bidBean.bidItem.history}" var="history"
	                   emptyMessage="No bid history yet."
	                   reorderableColumns="false" resizableColumns="false"
	                   paginator="true" paginatorAlwaysVisible="false" paginatorPosition="bottom"
	                   style="width: #{settingsBean.chartWidth}px;"
	                   rows="10"
	                   rendered="#{chartBean.type eq null}">
			        <f:facet name="header">
			            <h:outputText value="Details of #{bidBean.bidItem.bids} Bids"/>
			        </f:facet>
	                <ace:column headerText="Date/Time">
	                    <h:outputText value="#{history.date}">
	                        <f:convertDateTime pattern="EE hh:mm:ss"/>
	                    </h:outputText>
	                </ace:column>
	                <ace:column headerText="Bid Increase">
	                    <h:outputText value="#{history.bidIncrease}">
	                        <f:convertNumber type="currency" currencySymbol="$"/>
	                    </h:outputText>
	                </ace:column>
	                <ace:column headerText="Price">
	                    <h:outputText value="#{history.price}">
	                        <f:convertNumber type="currency" currencySymbol="$"/>
	                    </h:outputText>
	                </ace:column>
	            </ace:dataTable>
            </h:panelGroup>
        </ace:dialog>
    </h:form>
</h:body>
</html>
